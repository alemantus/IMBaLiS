#include <ArduinoGraphics.h> // Arduino_MKRRGB depends on ArduinoGraphics
#include <Arduino_MKRRGB.h>
#include "approxFFT.h"

void setVerticalBar(int heightOfBar, int barNum, int lightPower[]) {
  MATRIX.beginDraw();
  MATRIX.stroke(lightPower[0], lightPower[1], lightPower[2]);
  MATRIX.line(barNum - 1, 0, barNum - 1, heightOfBar - 1);
  MATRIX.endDraw();
}

int musicSample[] = {
610,617,635,656,672,682,678,684,685,689,700,703,705,716,741,746,728,718,727,732,745,746,745,727,720,726,720,719,712,706,708,707,716,726,745,759,760,765,767,776,780,784,776,765,744,754,774,771,773,776,758,750,744,745,751,751,762,770,780,794,791,796,804,795,799,804,811,816,825,829,842,838,832,836,840,841,831,834,829,834,827,828,819,803,802,806,794,792,803,812,815,826,845,862,884,902,908,915,900,894,897,892,891,894,898,891,877,864,871,897,914,920,939,945,952,954,945,929,921,904,905,913,908,921,926,921,920,913,907,918,927,924,909,913,916,907,902,903,913,914,904,905,912,926,941,950,953,952,949,942,933,920,926,938,950,950,934,912,900,889,875,871,874,872,882,888,902,917,932,943,946,947,948,951,955,951,947,948,943,936,934,929,935,948,954,952,953,943,931,929,932,933,941,953,950,943,942,943,945,949,948,954,957,951,943,944,943,926,911,913,916,919,925,937,959,967,956,952,959,966,964,964,964,960,965,961,954,962,967,969,964,955,948,944,951,959,966,965,961,956,958,964,953,934,931,939,931,932,935,932,922,906,896,901,905,913,924,942,950,950,957,947,926,921,920,914,912,920,928,929,926,929,929,921,914,920,920,918,916,910,898,886,891,891,908,918,913,912,918,918,902,890,886,886,888,889,888,889,890,881,877,879,871,883,911,919,931,942,945,957,958,945,925,917,921,927,934,942,947,944,939,933,922,910,905,905,904,900,903,899,889,885,882,886,881,872,863,855,852,861,859,854,864,868,874,883,882,884,890,892,893,883,876,872,879,875,873,870,866,862,849,842,829,823,813,804,798,789,779,777,771,755,757,760,757,751,752,762,771,769,761,768,769,765,761,754,750,743,736,728,724,713,700,683,673,666,662,670,683,683,677,674,668,665,667,666,675,687,687,679,668,659,660,661,660,660,664,667,662,661,656,653,645,638,628,623,624,620,616,607,591,570,558,559,565,575,586,589,579,567,557,549,549,552,556,557,556,552,554,560,556,541,536,541,538,534,525,524,521,528,529,514,500,484,474,464,454,452,449,444,437,433,442,445,441,429,423,427,433,434,425,418,411,406,403,395,382,374,371,367,364,364,358,357,356,344,336,335,328,324,319,312,309,314,320,320,326,331,330,327,326,327,321,313,305,302,300,295,289,292,291,293,293,280,268,257,248,246,236,227,223,219,219,221,222,228,228,226,227,230,236,248,257,260,259,259,255,247,238,230,230,243,248,235,226,210,201,199,208,220,223,221,222,217,216,220,212,206,203,205,213,223,227,217,203,191,179,175,172,165,161,162,154,154,152,145,138,133,125,119,123,121,109,107,116,112,112,112,108,109,108,102,98,109,118,115,110,98,96,101,102,105,104,107,109,110,113,110,103,97,92,84,79,80,76,67,63,62,60,61,64,70,73,75,81,83,82,80,68,54,53,49,51,58,61,54,43,44,50,51,47,44,45,52,55,55,61,61,61,68,77,84,86,82,75,69,69,71,73,73,78,83,78,69,59,61,66,60,47,41,45,42,37,38,41,37,37,42,43,41,41,42,41,37,32,35,46,51,49,51,60,63,55,48,44,43,46,41,37,40,50,59,62,67,68,63,61,62,68,77,87,89,91,82,73,64,59,65,65,60,70,76,75,77,77,71,58,52,51,49,50,52,52,61,63,57,52,47,48,62,78,90,101,109,116,118,118,118,114,108,102,97,101,109,117,116,116,118,123,125,123,114,108,106,99,92,88,81,75,74,77,81,85,91,87,76,72,75,86,99,111,122,127,128,131,130,135,145,150,145,145,147,145,152,153,144,137,129,122,118,120,125,126,120,117,118,118,116,116,121,126,133,143,149,152,158,159,158,161,169,172,177,184,186,185,189,195,192,183,175,169,166,167,165,168,167,164,163,162,162,160,168,177,183,189,192,192,193,199,211,225,233,236,238,238,242,248,257,254,252,259,259,251,253,252,239,229,223,217,220,226,227,225,224,221,219,224,233,244,249,261,279,286,276,268,265,260,266,275,284,294,298,291,283,282,283,281,286,299,306,305,306,309,313,315,315,316,316,319,329,342,352,356,355,357,365,376,378,380,381,376,364,362,369,366,363,369,378,380,383,383,379,378,378,376,375,381,384,385,385,383,387,394,401,404,403,406,413,426,442,457,475,491,500,504,508,510,514,516,510,503,501,502,502,508,511,507,505,503,499,496,504,511,518,530,532,530,530,530,525,525,531,541,550,549,545,547,551,556,558,559,558,560,562,563,571,578,585,596,609,621,627,629,626,625,625,624,628,637,638,634,638,646,648,642,639,632,623,622,627,628,626,628,630,629,625,621,618,624,634,643,656,665,667,671,680,687,684,688,696,701,710,721,731,739,739,733,722,715,713,713,714,714,717,720,724,726,729,730,731,734,739,745,750,751,751,751,747,743,742,749,755,760,769,777,778,779,782,785,795,807,815,821,833,843,842,837,834,829,826,831,832,825,818,816,811,807,808,807,807,814,822,824,823,828,834,839,843,848,848,844,845,850,854,855,855,853,856,866,871,874,887,899,899,897,894,892,887,879,873,872,873,869,867,866,863,860,862,862,859,862,868,880,892,897,903,902,896,889,889,896,902,907,912,914,915,912,905,900,898,898,904,914,918,915,906,899,893,886,884,889,901,905,903,905,905,904,908,912,911,911,912,918,932,940,937,929,923,919,918,920,923,922,920,925,927,916,902,894,890,885,891,896,898,899,893,889,892,903,910,910,911,911,917,923,927,931,935,934,930,931,930,926,926,925,920,913,912,919,922,924,922,922,923,918,913,910,911,917,920,921,921,924,926,931,936,931,926,924,922,915,910,909,913,916,913,905,898,898,905,910,911,908,903,902,904,903,901,904,912,919,915,910,906,902,901,902,901,902,902,898,892,887,888,893,891,888,887,885,886,891,894,886,875,866,861,858,854,851,853,858,863,868,864,853,848,851,854,853,856,862,864,862,853,846,843,839,835,836,836,835,836,839,835,827,820,815,810,808,816,828,833,829,823,821,828,832,834,837,840,837,830,823,816,812,812,815,817,817,816,817,816,811,806,807,815,817,816,820,826,830,825,822,822,813,806,806,804,801,801,801,796,789,787,785,787,796,802,800,794,790,785,775,767,771,775,774,774,777,781,783,783,778,776,776,771,769,773,775,774,774,775,776,767,756,752,756,755,748,746,748,744,739,739,736,730,725,720,715,710,707,704,700,699,699,697,690,685,683,677,672,671,665,652,648,651,650,656,663,657,644,637,634,630,625,621,622,622,626,629,629,630,626,617,613,611,604,599,596,592,584,577,578,576,568,563,562,560,558,561,565,561,555,552,547,546,547,549,549,546,545,546,544,537,530,522,515,506,503,505,505,503,502,505,505,496,483,478,483,482,482,489,488,478,469,463,458,456,460,460,458,457,455,450,446,442,436,433,428,424,425,424,415,408,404,396,388,386,388,390,388,386,385,383,376,371,364,358,356,359,358,353,349,349,346,338,336,336,336,327,315,311,315,320,322,322,318,318,317,306,293,285,282,279,276,279,283,288,292,289,279,269,265,266,271,273,272,270,262,251,242,240,242,239,238,242,248,255,260,261,251,239,231,229,229,229,234,241,237,222,211,206,202,203,204,202,202,205,204,200,193,186,184,189,192,194,196,197,196,191,185,183,185,188,184,177,175,174,172,168,166,166,164,159,156,155,157,160,161,162,161,157,155,156,158,154,148,140,136,138,135,137,141,135,133,138,140,137,136,132,126,128,133,133,131,128,123,117,114,110,108,110,115,117,116,114,112,110,109,110,108,100,96,98,98,105,113,115,110,101,93,89,88,88,88,92,94,92,91,98,103,96,92,93,93,93,92,91,94,94,91,90,94,98,98,97,101,102,98,95,95,97,96,90,91,99,103,100,97,100,93,85,88,93,92,91,96,95,92,99,102,97,100,103,99,94,92,90,86,88,93,96,98,103,106,107,108,105,100,100,102,100,98,101,100,96,96,103,109,106,102,104,103,101,104,109,117,117,116,115,115,117,119,123,129,130,125,122,126,130,129,129,130,131,134,133,132,132,128,127,128,124,122,124,129,134,138,139,143,147,139,129,130,139,142,150,160,160,158,155,149,141,138,142,149,155,160,163,166,164,156,151,152,153,155,160,166,173,179,180,179,177,174,170,165,162,163,168,170,176,181,182,178,170,164,166,171,174,181,189,190,186,189,196,197,191,189,192,197,200,204,207,206,204,202,203,204,204,207,212,212,208,206,204,202,207,212,219,229,237,236,229,224,227,231,230,230,233,234,234,238,245,250,250,247,243,242,245,251,259,266,269,269,263,255,252,257,264,273,280,283,282,281,283,288,290,284,280,281,284,287,291,296,305,309,309,310,305,299,301,305,306,310,320,324,323,321,316,311,318,325,326,329,331,331,332,333,331,325,322,330,344,353,354,355,354,352,353,353,353,358,361,356,350,357,370,374,378,385,385,379,378,383,383,383,387,397,403,403,401,400,403,410,416,423,431,437,434,425,420,421,429,436,445,455,459,455,451,456,462,461,465,474,478,478,483,487,490,492,494,493,493,497,500,500,503,515,522,522,527,535,534,532,537,541,544,552,558,558,553,549,548,551,557,562,566,571,574,579,590,597,599,602,602,598,595,596,600,607,614,617,615,610,608,609,612,617,623,624,628,634,635,635,640,639,633,632,640,643,648,657,660,656,652,653,653,654,655,655,661,666,664,668,677,677,672,673,678,680,683,689,696,701,708,714,716,715,717,717,718,724,729,732,728,720,714,713,716,719,719,726,734,737,741,751,756,754,757,761,762,761,763,767,770,772,777,781,782,781,781,787,791,793,796,799,797,798,805,809,807,808,812,814,813,816,825,830,828,827,832,837,838,838,841,844,840,841,848,848,847,850,849,850,854,850,847,851,859,862,862,866,872,871,870,872,872,873,876,880,883,881,873,868,870,877,880,879,881,882,879,883,889,889,888,888,888,890,893,893,895,895,892,893,896,889,882,882,884,886,889,895,897,893,891,893,891,888,886,887,891,896,900,901,900,895,891,890,894,897,897,901,905,904,908,909,905,898,899,902,905,910,911,913,915,912,905,904,900,892,889,895,900,904,913,919,918,918,921,921,920,923,925,923,924,927,930,928,927,925,919,919,924,923,918,916,918,922,926,929,930,928,927,926,923,922,920,914,913,916,920,921,924,926,927,927,928,927,923,914,909,906,904,903,900,898,897,894,892,891,893,898,903,905,904,902,900,898,896,895,894,895,895,894,893,890,885,878,875,876,878,880,883,881,878,875,872,868,861,856,855,858,861,865,868,866,866,864,859,855,852,850,852,852,853,854,851,848,844,841,837,830,826,828,830,831,833,838,838,837,837,836,833,832,830,831,833,837,838,835,831,826,821,818,815,810,810,811,807,805,807,806,805,806,806,806,808,808,807,808,810,807,800,797,795,794,796,798,800,798,795,793,793,790,785,786,786,782,779,781,779,771,769,775,775,770,773,778,777,776,777,775,767,757,750,748,747,745,746,745,741,736,738,737,732,728,723,722,724,723,724,729,731,730,731,729,722,720,720,720,719,721,718,713,707,701,701,700,697,693,691,691,690,690,688,683,680,680,678,680,682,678,676,672,668,661,652,647,642,638,635,630,629,628,625,624,624,623,618,610,606,600,594,592,592,591,592,589,585,581,578,576,571,570,567,557,551,554,555,549,545,547,542,537,538,536,527,517,515,518,518,516,514,514,516,515,516,516,511,505,500,496,493,494,494,491,486,485,482,478,476,473,469,463,458,456,454,450,444,441,440,440,441,443,442,437,433,431,430,424,419,414,410,408,408,403,397,391,386,382,379,378,376,376,381,382,380,378,374,365,355,351,349,349,351,352,353,353,349,342,336,332,323,315,312,311,307,302,299,298,295,292,290,289,286,285,284,284,285,283,279,277,275,270,264,266,269,263,253,249,246,240,237,236,233,234,233,227,225,224,220,215,216,217,214,218,223,221,219,221,218,209,206,208,207,203,199,201,203,202,200,202,202,195,185,182,181,178,175,175,176,176,176,176,178,179,178,176,173,174,171,165,164,163,162,162,160,160,162,158,153,151,149,143,136,140,146,147,145,142,143,143,141,139,137,132,124,120,122,125,124,122,123,126,124,118,121,121,118,116,115,114,113,115,117,115,114,114,112,106,102,101,98,97,103,105,102,98,93,89,89,87,85,85,84,83,86,88,88,89,88,88,90,92,92,90,91,89,86,84,82,79,80,84,86,83,82,80,78,76,75,74,69,71,79,82,82,87,89,83,76,74,70,67,73,78,79,86,93,89,83,81,79,75,78,81,82,85,89,90,92,94,93,90,89,90,90,87,86,87,89,89,90,95,97,96,98,100,99,100,101,99,98,104,109,110,112,113,111,110,109,106,105,108,109,111,118,124,123,121,124,123,119,117,118,116,114,115,114,113,116,115,117,125,130,129,130,131,125,120,121,123,124,126,129,133,137,136,133,134,135,131,129,133,134,131,133,137,140,143,145,147,149,146,143,147,153,156,156,157,159,162,165,165,166,164,158,156,157,158,161,164,166,169,174,177,179,182,183,182,181,185,187,186,189,196,197,192,190,192,193,192,194,197,200,201,201,206,215,216,213,213,211,206,203,204,207,210,214,217,220,229,237,241,241,242,244,247,251,250,246,246,246,242,240,242,247,246,241,243,244,244,248,250,250,257,261,261,265,269,269,270,272,275,279,287,289,289,297,302,302,303,307,306,300,301,303,301,303,308,312,309,309,315,312,307,306,308,315,319,321,326,331,328,324,330,334,332,335,340,339,337,343,347,344,339,340,344,344,348,356,356,353,354,355,356,360,366,371,375,382,390,392,397,402,398,394,396,399,401,406,409,408,412,417,417,414,416,421,422,423,427,431,433,435,441,446,450,454,454,455,462,464,460,459,461,462,465,469,477,485,485,483,488,491,488,487,493,495,500,511,516,520,525,528,527,528,535,535,534,542,549,552,557,561,559,556,558,561,564,568,572,576,579,582,583,583,588,594,597,596,599,603,602,604,608,610,612,616,619,621,628,636,636,637,645,646,639,637,641,644,642,641,644,648,647,647,653,659,663,665,668,674,674,667,662,664,666,671,679,687,690,691,694,697,697,698,696,695,697,702,706,710,715,718,719,716,711,711,713,713,716,726,734,736,737,741,744,744,742,744,749,751,747,752,760,760,758,763,770,772,775,781,786,788,787,786,790,794,796,800,805,806,805,808,811,809,809,813,815,816,818,822,827,827,826,828,831,830,826,829,838,842,841,844,845,844,842,844,851,858,862,863,863,863,861,856,855,857,859,859,863,867,868,870,872,873,871,868,866,866,870,874,876,880,885,885,883,880,877,875,877,879,880,886,889,884,886,891,888,890,893,891,890,893,894,889,886,885,885,885,889,894,894,890,888,891,893,888,885,892,898,901,901,898,896,893,890,887,888,892,896,898,901,904,904,903,902,900,901,901,902,905,910,914,910,905,905,904,903,905,907,907,907,908,911,915,916,913,912,913,913,912,915,912,908,909,909,909,912,913,913,913,917,920,921,923,924,925,926,920,917,920,916,908,906,908,911,916,920,923,922,917,910,907,906,904,903,905,905,903,902,902,902,898,897,901,898,891,892,895,897,897,899,901,898,890,883,882,884,877,866,865,868,868,871,876,878,874,872,871,870,867,865,867,868,866,866,864,856,847,843,842,842,844,847,847,848,847,842,840,841,837,832,833,837,833,826,827,826,822,820,820,819,818,821,823,821,822,823,817,814,813,810,806,807,809,803,797,798,798,796,797,800,803,807,811,808,804,805,802,798,798,799,796,795,796,794,787,786,784,776,773
};

void setup() {
  Serial.begin(115200);
  // put your setup code here, to run once:
  MATRIX.begin();

  // set the brightness, supported values are 0 - 255
  MATRIX.brightness(10);

}

void loop() {
  // put your main code here, to run repeatedly:
  int numberOfSamples = 1024;
  int dataOut[1024];

  Approx_FFT(musicSample, numberOfSamples, dataOut);
  int LED_buffer[1024];

  binning_9(numberOfSamples, dataOut, LED_buffer);

  MATRIX.beginDraw();
  MATRIX.clear(); 
  MATRIX.endDraw();
  int rgb[] = {20, 50, 100};
  for (int i = 0; i < 9; i++) {
  

    setVerticalBar(map(LED_buffer[i], 0, 15000, 0, 7), i, rgb);
    Serial.print('\t');
    Serial.print(LED_buffer[i]);
    //Serial.print(map(LED_buffer[i], 0, 10000, 0, 7));



  }
  Serial.println();
  for (int i = 0; i < (sizeof(musicSample) / sizeof(musicSample[0])) - 1; i++) {
    musicSample[i] = musicSample[i + 1];
  }



}
